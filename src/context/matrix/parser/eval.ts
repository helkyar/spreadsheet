export const safeEval = (expression: string, isSafe: boolean) => {
  try {
    if (!isSafe && isPolluted(expression)) return '##Error: security concerns'
    return eval(expression)
  } catch (error) {
    return `##Error: ${error}`
  }
}
export function isPolluted(expression: string) {
  const securityConcerns = [
    'func',
    'function',
    '=>',
    '=',
    'Function',
    'fetch',
    'XMLHttpRequest',
    'eval',
    'setTimeout',
    'setInterval',
    'setImmediate',
    'clearTimeout',
    'clearInterval',
    'clearImmediate',
    'process',
    'global',
    'require',
    'module',
    'import',
    'export',
    'window',
    'document',
    'localStorage',
    'sessionStorage',
    'cookie',
    'indexedDB',
    'webkitIndexedDB',
    'mozIndexedDB',
    'msIndexedDB',
    'openDatabase',
    'alert',
    'prompt',
    'confirm',
    'console',
    'debugger',
    'postMessage',
    'onmessage',
    'onerror',
    'onload',
    'onunload',
    'onbeforeunload',
    'onpopstate',
    'onstorage',
    'onfocus',
    'onblur',
    'onresize',
    'onmove',
    'onopen',
    'onclose',
    'onquit',
    'onabort',
    'oncancel',
    'oncanplay',
    'onchange',
    'onclick',
    'oncontextmenu',
    'ondblclick',
    'ondrag',
    'ondragend',
    'ondragenter',
    'ondragleave',
    'ondragover',
    'ondragstart',
    'ondrop',
    'ondurationchange',
    'onemptied',
    'onended',
    'onerror',
    'onfocus',
    'oninput',
    'oninvalid',
    'onkeydown',
    'onkeypress',
    'onkeyup',
    'onload',
    'onloadeddata',
    'onloadedmetadata',
    'onloadstart',
    'onmousedown',
    'onmousemove',
    'onmouseout',
    'onmouseover',
    'onmouseup',
    'onmousewheel',
    'onpause',
    'onplay',
    'onplaying',
    'onprogress',
    'onratechange',
    'onreset',
    'onresize',
    'onscroll',
    'onseeked',
    'onseeking',
    'onselect',
    'onshow',
    'onstalled',
    'onsubmit',
    'onsuspend',
    'ontimeupdate',
    'onvolumechange',
    'onwaiting',
    'onwheel',
    'oncopy',
    'oncut',
    'onpaste',
    'onbeforecopy',
    'onbeforecut',
    'onbeforepaste',
    'onsearch',
    'onfullscreenchange',
    'onfullscreenerror',
    'onwebkitfullscreenchange',
    'onwebkitfullscreenerror',
    'onabort',
    'onblur',
    'onchange',
    'onclick',
    'oncontextmenu',
    'ondblclick',
    'onerror',
    'onfocus',
    'oninput',
    'oninvalid',
    'onkeydown',
    'onkeypress',
    'onkeyup',
    'onload',
    'onmousedown',
    'onmousemove',
    'onmouseout',
    'onmouseover',
    'onmouseup',
    'onmousewheel',
    'onresize',
    'onscroll',
    'onselect',
    'onsubmit',
    'onunload',
    'onhashchange',
    'onpageshow',
    'onpagehide',
    'onbeforeunload',
    'onblur',
    'onerror',
    'onfocus',
    'onload',
    'onresize',
    'onscroll',
    'onunload',
    'onmessage',
    'onopen',
    'onabort',
    'onbeforeunload',
    'onerror',
    'onhashchange',
    'onload',
    'onpageshow',
    'onpagehide',
    'onresize',
    'onscroll',
    'onunload',
    'onblur',
    'onerror',
    'onfocus',
    'onload',
    'onresize',
    'onscroll',
    'onunload',
    'oncopy',
    'oncut',
    'onpaste',
    'onbeforecopy',
    'onbeforecut',
    'onbeforepaste',
    'onsearch',
    'onfullscreenchange',
    'onfullscreenerror',
    'onwebkitfullscreenchange',
    'onwebkitfullscreenerror',
    'onabort',
    'onblur',
    'onchange',
    'onclick',
    'oncontextmenu',
    'ondblclick',
    'onerror',
    'onfocus',
    'oninput',
    'oninvalid',
    'onkeydown',
    'onkeypress',
    'onkeyup',
    'onload',
    'onmousedown',
    'onmousemove',
    'onmouseout',
    'onmouseover',
    'onmouseup',
    'onmousewheel',
    'onresize',
    'onscroll',
    'onselect',
    'onsubmit',
    'onunload',
    'onhashchange',
    'onpageshow',
    'onpagehide',
    'onbeforeunload',
    'onblur',
    'onerror',
    'onfocus',
    'onload',
    'onresize',
    'onscroll',
    'onunload',
    'onmessage',
    'onopen',
    'onabort',
    'onbeforeunload',
    'onerror',
    'onhashchange',
    'onload',
    'onpageshow',
    'onpagehide',
    'onresize',
    'onscroll',
    'onunload',
    'onblur',
    'onerror',
    'onfocus',
    'onload',
    'onresize',
    'onscroll',
    'onunload',
    'oncopy',
    'oncut',
    'onpaste',
    'onbeforecopy',
    'onbeforecut',
    'onbeforepaste',
    'onsearch',
    'onfullscreenchange',
    'Event',
  ]
  for (const securityConcern of securityConcerns) {
    if (expression.includes(securityConcern)) return true
  }
}
